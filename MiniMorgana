--[[
 __  __ _       _   __  __                                   
|  \/  (_)     (_) |  \/  |                                  
| \  / |_ _ __  _  | \  / | ___  _ __ __ _  __ _ _ __   __ _ 
| |\/| | | '_ \| | | |\/| |/ _ \| '__/ _` |/ _` | '_ \ / _` |
| |  | | | | | | | | |  | | (_) | | | (_| | (_| | | | | (_| |
|_|  |_|_|_| |_|_| |_|  |_|\___/|_|  \__, |\__,_|_| |_|\__,_|
                                      __/ |                  
                                     |___/  

AddOn for 2.0 by DeadDevil2
]]


local TS = TargetSelector(TargetSelector_Mode.LESS_CAST, TargetSelector_DamageType.MAGIC) 


Callback.Bind('Load', function()

  Callback.Bind('GameStart', function() OnStart() end)

end)

function OnStart()
    if myHero.charName ~= 'Morgana' then return end

	Morgana = MenuConfig("Mini Morgana")
    	Morgana:Icon("fa-user")

  	Morgana:Menu("Combo", "Combo Settings")
      	Morgana.Combo:Icon("fa-folder-o")
     	Morgana.Combo:Section("Combo Settings", "Combo Settings")  
    	Morgana.Combo:Boolean("useq", "Use Q", true)
    	Morgana.Combo:Boolean("usew", "Use W", true)
  
  	Morgana:Menu("Harass", "Harass Settings")
      	Morgana.Harass:Icon("fa-folder-o")
     	Morgana.Harass:Section("Harass Settings", "Harass Settings")  
	Morgana.Harass:Boolean("usew", "Use W", true)

	Morgana:Menu("Ks", "KS Settings")
      	Morgana.Ks:Icon("fa-github-alt")
      	Morgana.Ks:Section("KS Settings", "KS Settings")  
      	Morgana.Ks:Boolean("useq", "Use Q", true)
      	Morgana.Ks:Boolean("usew", "Use W", false)

    	Morgana:Menu("Draw", "Draw Settings")
      	Morgana.Draw:Boolean("Enable", "Enable Drawings", true)
      	Morgana.Draw:Section("drawrange", "Draw Skill Range") 
      	Morgana.Draw:Boolean("drawq", "Draw Q Range")
      	Morgana.Draw:Boolean("draww", "Draw W Range")
      	Morgana.Draw:Boolean("drawe", "Draw E Range")
      	Morgana.Draw:Boolean("drawr", "Draw R Range")
      	Morgana.Draw:DropDown("Colors", "Colors", 1, {"Red","Green","Blue","White"})
      	Morgana.Draw:Icon('fa-pencil')

      	Morgana:Menu("Adds", "Additionals")
      	Morgana.Adds:Icon("fa-folder-o")
      	Morgana.Adds:Boolean("onlywq", "Only use W if Q connects", true)
      	Morgana.Adds:Boolean("orbwalk", "Orbwalk", true)


      	Morgana:Section('Keys', 'Keys')
    	Morgana:KeyBinding('combokey', 'Combo', 'SPACE')
    	Morgana:KeyBinding('harasskey', 'Harass', 'A')

		
    	BasicPrediction.EnablePrediction()

    	Target = TS:GetTarget(1300) 
    	

	    Color = { Red = Graphics.ARGB(0xFF,0xFF,0,0),
	            Green = Graphics.ARGB(0xFF,0,0xFF,0),
	            Blue = Graphics.ARGB(0xFF,0,0,0xFF),
	            White = Graphics.ARGB(0xFF,0xFF,0xFF,0xFF)
	            }

    Callback.Bind('Tick', function() OnTick() end)
    Callback.Bind('Draw', function() OnDraw() end)


    Game.Chat.Print("<font color=\"#7401DF\">Mini Morgana 1.0 by DeadDevil2 loaded! </font>")

end

function OnTick()
	Checks()
	Combo()
	Orbwalk()
end

function Checks()

	Qready = myHero:CanUseSpell(0) == Game.SpellState.READY
    Wready = myHero:CanUseSpell(1) == Game.SpellState.READY
    Eready = myHero:CanUseSpell(2) == Game.SpellState.READY
    Rready = myHero:CanUseSpell(3) == Game.SpellState.READY

end

function TargetHasBuff(unit, name)
	for i = 1, unit.buffCount do
        local buff = unit:GetBuff(i)
        if buff and buff.name == name and buff.startT <= Game.ServerTimer() and buff.endT >= Game.ServerTimer() then
            return buff
        end
 	end
end

function Combo()
	local Target = TS:GetTarget(1300) 
	if Morgana.combokey:IsPressed() then
		if Target ~= nil and Target.type == myHero.type and Target.team == TEAM_ENEMY and not Target.dead then
			if Morgana.Combo.useq:Value() and Allclass.GetDistance(Target) < 1300 and Qready then 
	 			local PPos, WHC  = BasicPrediction.GetPredictedPosition(Target, 1300, 1200, 0.5, 110, true, false, myHero)
	      		if PPos and PPos.x and PPos.y and PPos.z and WHC >= 2 then
	        		myHero:CastSpell(0, PPos.x, PPos.z)

	        	end
	        end 
	        if Morgana.Combo.usew:Value() and Morgana.Adds.onlywq:Value() and Allclass.GetDistance(Target) < 1075 and Wready and TargetHasBuff(Target, "DarkBindingMissile") then 
	        	myHero:CastSpell(1, Target.x, Target.z)
	        end
	        if Morgana.Combo.usew:Value() and not Morgana.Adds.onlywq:Value() and Allclass.GetDistance(Target) < 1075 and Wready then
	        	myHero:CastSpell(1, Target.x, Target.z)
	        end
	    end
	end
end

function Harass()
	local Target = TS:GetTarget(1300) 
	if Morgana.harasskey:IsPressed() then
		if Target ~= nil and Target.type == myHero.type and Target.team == TEAM_ENEMY and not Target.dead then
			if Morgana.Harass.usew:Value() and Allclass.GetDistance(Target) < 1075 and Wready then
	        	myHero:CastSpell(1, Target.x, Target.z)
	        end
	    end
	end
end

function Autozhonya()
	if Morgana.Adds.usez:Value() then
		if myHero.health <= (myHero.maxHealth*(Morgana.Adds.hz:Value()/100)) then Allclass.CastItem(3157) --- ?
		end
	end
end

function Orbwalk()
	if Morgana.combokey:IsPressed() and Morgana.Adds.orbwalk:Value() then
		myHero:Move(mousePos.x, mousePos.z)
	end
end


function OnDraw()
	-- Thanks to Woody for this cool idea!
	if Morgana.Draw.Colors:Value() == 1 then 
      Farbe = Color.Red
    elseif Morgana.Draw.Colors:Value() == 2 then
      Farbe = Color.Green
    elseif Morgana.Draw.Colors:Value() == 3 then
      Farbe = Color.Blue
    elseif Morgana.Draw.Colors:Value() == 4 then
      Farbe = Color.White
    end
	
	if Morgana.Draw.Enable:Value() then
        if (Morgana.Draw.drawq:Value()) then
          Graphics.DrawCircle(myHero, 1300, Farbe)
        end
        if (Morgana.Draw.draww:Value()) then
          Graphics.DrawCircle(myHero, 1075, Farbe)
        end
        if (Morgana.Draw.drawe:Value()) then
          Graphics.DrawCircle(myHero, 750, Farbe)
        end
        if (Morgana.Draw.drawr:Value()) then
          Graphics.DrawCircle(myHero, 600, Farbe)
        end
    end
end

